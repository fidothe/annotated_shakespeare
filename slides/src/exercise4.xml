<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" schematypens="http://relaxng.org/ns/structure/1.0"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <info>
        <title>Practical Web Applications: Exercise 4</title>
        <authorgroup>
            <author>
                <personname>
                    <firstname>Lauren</firstname>
                    <surname>Wood</surname>
                </personname>
                <affiliation>
                    <orgname>Textuality Services, Inc.</orgname>
                </affiliation>
            </author>
            <author>
                <personname>
                    <firstname>Matt</firstname>
                    <surname>Patterson</surname>
                </personname>
                <affiliation>
                    <orgname>Constituent Parts, Ltd.</orgname>
                </affiliation>
            </author>
            <author>
                <personname>
                    <firstname>Norman </firstname>
                    <surname>Walsh</surname>
                </personname>
                <affiliation>
                    <orgname>MarkLogic</orgname>
                </affiliation>
            </author>
            <author>
                <personname>
                    <firstname>Paul</firstname>
                    <surname>Downey</surname>
                </personname>
                <affiliation>
                    <orgname>GDS</orgname>
                </affiliation>
            </author>
        </authorgroup>
        <releaseinfo role="version">Version 1.0</releaseinfo>
        <legalnotice>
            <para>Alpha by first name</para>
        </legalnotice>
        <pubdate>2012-09-20</pubdate>
        <copyright>
            <year>2012</year>
            <holder>Lauren Wood, Matt Patterson, Norm Walsh, Paul Downey</holder>
        </copyright>
        <legalnotice>
            <para>CC-BY-NC-SA-3.0 Licensed under a Creative Commons Attribution-Noncommercial-Share
                Alike 3.0 Unported License</para>
        </legalnotice>
    </info>
    <simplesect>
        <title>Summary</title>
        <para>In this exercise, we'll be adding comments to our application.</para>
    </simplesect>
    <simplesect>
        <title>Setup</title>
        <para>Make sure you're up to date on the code we created in
        the last set of exercises. Go to your repository folder in a
        terminal window and type git checkout session_three to get all
        the code from session three. Copy this code, in the correct
        folders, across to your working folders.</para>
    </simplesect>
<simplesect>
  <title>Steps, part one</title>
  <orderedlist>
    <listitem>
      <para>Add <code>data_mapper</code> to your <filename>Gemfile</filename>:</para>
      <programlisting language="ruby"><xi:include href="ex/dm-gemfile.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part two</title>
  <orderedlist>
    <listitem>
      <para>Update your <filename>lib/annotated_shakespeare.rb</filename> to use Data Mapper:</para>
      <programlisting language="ruby"><xi:include href="ex/app-dm_setup.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part three</title>
  <orderedlist>
    <listitem>
      <para>Create <filename>lib/comment.rb</filename></para>
      <programlisting language="ruby"><xi:include href="ex/comment-model.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part four</title>
  <orderedlist>
    <listitem>
      <para>Add forms to <filename>views/show.erb</filename></para>

      <programlisting language="html+erb"><xi:include href="ex/comment-form.erb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part five</title>
  <orderedlist>
    <listitem>
      <para>Add support for comments to <filename>lib/annotated_shakespeare.rb</filename>:</para>
      <programlisting language="ruby"><xi:include href="ex/comment-create.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part six</title>
  <orderedlist>
    <listitem>
      <para>Create <filename>lib/comment.rb</filename></para>
      <programlisting language="ruby"><xi:include href="ex/comment-with_association.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part seven</title>
  <orderedlist>
    <listitem>
      <para>Add type and ID to <filename>lib/annotated_shakespeare.rb</filename>:</para>
      <programlisting language="ruby"><xi:include href="ex/comment-create-with_association.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part eight</title>
  <orderedlist>
    <listitem>
      <para>Add redirection to <filename>lib/annotated_shakespeare.rb</filename>:</para>
      <programlisting language="ruby"><xi:include href="ex/comment-create_with_redirect.rb" parse="text"/></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part nine</title>
  <orderedlist>
    <listitem>
      <para>Create <filename>lib/comment.rb</filename>:</para>
      <programlisting language="ruby"><![CDATA[
class Comment
  def self.for(type, id)
    Comment.all(:commentable_type => type.to_s,
                :commentable_id => id.to_s)
  end
end
]]></programlisting>
    </listitem>
    <listitem>
      <para>and <filename>lib/act.rb</filename>:</para>
      <programlisting language="ruby"><![CDATA[
class Act
  def comments
    Comment.for(:act, @number)
  end
end
]]></programlisting>
    </listitem>
  </orderedlist>
</simplesect>

<simplesect>
  <title>Steps, part ten</title>
  <orderedlist>
    <listitem>
      <para>Update <filename>lib/show.erb</filename> to display the comments:</para>
      <programlisting language="html+erb"><xi:include href="ex/comment-act-view.erb" parse="text"/></programlisting>
    </listitem>
    <listitem>
      <para>Try it out.</para>
    </listitem>
  </orderedlist>
</simplesect>

</article>
