<?dbhtml pygments="true"?>
<slides xml:lang="en" xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">
  <info>
    <title>Practical Web Applications</title>
    <subtitle>Session One</subtitle>
    <!-- authors are alphabetical by first name (I get sick of being listed last all the time, 
so I always do this if I can) -->
    <authorgroup>
      <author>
        <personname>
          <firstname>Lauren</firstname>
          <surname>Wood</surname>
        </personname>
        <affiliation>
          <orgname>Textuality Services, Inc.</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Matt</firstname>
          <surname>Patterson</surname>
        </personname>
        <affiliation>
          <orgname>Constituent Parts, Ltd.</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Norman </firstname>
          <surname>Walsh</surname>
        </personname>
        <affiliation>
          <orgname>MarkLogic</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Paul</firstname>
          <surname>Downey</surname>
        </personname>
        <affiliation>
          <orgname>GDS</orgname>
        </affiliation>
      </author>
    </authorgroup>
    <releaseinfo role="version">Version 1.0</releaseinfo>
    <legalnotice>
      <para>Alpha by first name</para>
    </legalnotice>
    <pubdate>2012-09-20</pubdate>
    <copyright>
      <year>2012</year>
      <holder>Lauren Wood, Matt Patterson, Norm Walsh, Paul Downey</holder>
    </copyright>
  </info>
  <foilgroup>
    <title>What is HTML?</title>
    <foil>
      <title>Hypertext Markup Language</title>
      <itemizedlist>
        <listitem>
          <para>An XMLish document markup language</para>
        </listitem>
      </itemizedlist>
      <programlisting language="xml"><xi:include href="ex/barebones_html.xml" parse="text"/></programlisting>
      <speakernotes>
        <para>Let's begin by looking very quickly at HTML, the document part of the web. I imagine
          most of you are familiar with HTML, but we'll quickly go over the basics again. </para>
        <para>HTML began life as an SGML dialect, had a brief dalliance with XML in the form of
          XHTML, and most recently, after 10 years of schema stagnation, has been revived with the
          addition of new elements and new core-browser features, all gathered together under the
          banner of HTML 5, which isn't really SGML anymore either. </para>
        <para>The core document model is very simple: a root _html_ element, containing a _head_
          element with document metadata, and a _body_ element containing the content. </para>
      </speakernotes>
    </foil>
  </foilgroup>
  <foilgroup>
    <title>What is HTTP?</title>
    <foil>
      <title>HTTP flows</title>
      <para>Core HTTP protocol </para>
      <itemizedlist>
        <listitem>
          <para>Client requests a resource with certain parameters encoded as headers. </para>
        </listitem>
        <listitem>
          <para>Server responds with a status code, headers and a representation of the requested resource. </para>
        </listitem>
      </itemizedlist>
      <mediaobject role="center">
        <alt>application architecture components</alt>
        <imageobject>
          <imagedata fileref="../images/httpcore.svg"/>
        </imageobject>
      </mediaobject>
      <speakernotes>
        <para>To start with, I’m going to run through a brief version of what really happens when
          you click on a link in a web page. This will set the stage for all the authentication and
          authorisation workflows, as the ones we’re talking about here all sit on top of HTTP in
          some way. This is going to be brief, and since a little inaccuracy can save a ton of
          arguments, I will be somewhat inaccurate when it seems like a good idea. </para>
        <para>HTTP is a client-server request-response protocol. The client (often a browser) wants
          to access a resource (e.g., web page) that’s hosted by a server (another application,
          usually running on a different computer). The client sends an HTTP request to the server,
          which then responds, hopefully by providing the requested resource (HTML page, image,
          etc). In more detail: the client sends a request message containing a request line (e.g.,
          GET /pubs/1.html HTTP/1.1), headers such as acceptable languages, and an optional message
          body. The HTTP server response is a status code (e.g., HTTP/1.1 200 OK) and potentially
          other header information such as the content-length and/or last-modified date, as well as
          the body, containing potentially the resource, an error message, or other information. The
          list of headers is in a number of specifications, or in a more readable form in wikipedia.
        </para>
      </speakernotes>
    </foil>
    <foil>
      <title>HTTP tools</title>
      <itemizedlist>
        <listitem><para>Chrome</para></listitem>
        <listitem><para>Telnet</para></listitem>
        <listitem><para>Curl</para></listitem>
        <listitem><para>There are lots of others ..</para></listitem>
      </itemizedlist>
    </foil>
    <foil>
      <title>Chrome Web Developer</title>
      <mediaobject role="center">
        <alt>Chrome Web Developer</alt>
        <imageobject>
          <imagedata fileref="../images/Chrome-Developer-Tools.png"/>
        </imageobject>
      </mediaobject>
    </foil>
    <foil>
      <title>Chrome Web Developer Network</title>
      <mediaobject role="center">
        <alt>Chrome Web Developer Network</alt>
        <imageobject>
          <imagedata fileref="../images/Chrome-Network.png"/>
        </imageobject>
      </mediaobject>
    </foil>
    <foil>
      <title>Telnet</title>
      <programlisting language="http">
<![CDATA[
$ telnet google.com 80
GTrying 173.194.41.135...
Connected to google.com.
Escape character is '^]'.
GET / HTTP/1.1
]]>
</programlisting>
<programlisting language="http">
<![CDATA[
HTTP/1.1 302 Found
Location: http://www.google.co.uk/
Cache-Control: private
Content-Type: text/html; charset=UTF-8
]]>
</programlisting>
    </foil>
    <foil>
      <title>Curl</title>
      <programlisting language="bash">
<![CDATA[
$ curl -v http://www.google.com
* About to connect() to www.google.com port 80 (#0)
*   Trying 173.194.78.99... connected
* Connected to www.google.com (173.194.78.99) port 80 (#0)
> GET / HTTP/1.1
> User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8r zlib/1.2.5
> Host: www.google.com
> Accept: */*
> 
< HTTP/1.1 302 Found
< Location: http://www.google.co.uk/
< Cache-Control: private
< Content-Type: text/html; charset=UTF-8
< Set-Cookie: PREF=ID=4f9a...beb:FF=0:TM; expires=Tue, 16-Sep-2014 17:02:43 GMT; path=/; domain=.google.com
< P3P: CP="This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info."
< Date: Sun, 16 Sep 2012 17:02:43 GMT
< Server: gws
< Content-Length: 221
< X-XSS-Protection: 1; mode=block
< X-Frame-Options: SAMEORIGIN
< 
<HTML><HEAD><meta http-equiv="content-type" content="text/html;charset=utf-8">
<TITLE>302 Moved</TITLE></HEAD><BODY>
<H1>302 Moved</H1>
The document has moved
<A HREF="http://www.google.co.uk/">here</A>.
</BODY></HTML>
* Connection #0 to host www.google.com left intact
* Closing connection #0
]]>
</programlisting>
    </foil>
  </foilgroup>
  <foilgroup>
    <title>Web application architecture</title>
    <foil>
      <title>Web application components</title>
      <itemizedlist>
        <listitem>
          <para>HTTP Server</para>
        </listitem>
        <listitem>
          <para>Application code</para>
        </listitem>
        <listitem>
          <para>Static resources</para>
        </listitem>
      </itemizedlist>
      <mediaobject role="center">
        <alt>web application components</alt>
        <imageobject>
          <imagedata fileref="../images/http-client-server.svg"/>
        </imageobject>
      </mediaobject>
      <speakernotes>
        <para>Let's take the static HTML file that we've already loaded from disk into the browser
          and instead serve it to the browser from our HTTP server.</para>
        <para>To start with, we have some sinatra (ruby) code, and some HTML in a file in the
          ./public directory. Let's look at how this works.</para>
      </speakernotes>
    </foil>
    <foil>
      <title>Serving static HTML</title>
      <para>We're using a application server called Sinatra, which we need to configure so that it
        knows where to find static files it should serve</para>
      <programlisting language="ruby"><xi:include href="ex/static_only_app.rb" parse="text"/></programlisting>
      <para>We run the application using the <code>shotgun</code> command</para>
      <programlisting language="bash"><xi:include href="ex/invoke_shotgun.sh" parse="text"/></programlisting>
      <para>Now visit <code>http://localhost:9393/basic.html</code></para>
    </foil>
    <foil>
      <title>Let's try it out</title>
      <para/>
    </foil>
    <foil>
      <title>Framework architecture</title>
      <informaltable>
        <tr>
          <td align="center"><mediaobject>
              <alt>application architecture components</alt>
              <imageobject>
                <imagedata fileref="../images/app_architecture.png"/>
              </imageobject>
            </mediaobject></td>
          <td>&#160;</td>
          <td align="center"><mediaobject>
              <alt>application architecture components - the template piece</alt>
              <imageobject>
                <imagedata fileref="../images/app_architecture_template.jpg"/>
              </imageobject>
            </mediaobject></td>
        </tr>
        <tr>
          <td>A simplified view of the pieces - Sinatra (Ruby) code, templating system, static files
            (images, styles), variable content.</td>
          <td>&#160;</td>
          <td>We'll start with rendering basic HTML output, using the templating mechanism.</td>
        </tr>
      </informaltable>
      <speakernotes>
        <para>we'll get to the bits one at a time. Let's start with where we could put a basic,
          static, piece of HTML that we want the browser to show. </para>
        <para>To start with, we have some sinatra (ruby) code, and some HTML in a file in the
          ./views directory. It isn't a .html file; we'll get to the reasons why in a bit. First,
          let's look at what the code looks like for this.</para>
      </speakernotes>
    </foil>
    <foil>
      <title>Rendering a template</title>
      <para>The code in <code>lib/annotated_shakespeare.rb</code> should look like:</para>
      <programlisting language="ruby"><xi:include href="ex/render_static_equiv_app.rb" parse="text"/></programlisting>
    </foil>
    <foil>
      <title>Ruby code dissection</title>
      <programlisting role="other" language="ruby">
      <phrase role="kw">get</phrase> '/' <phrase role="kw">do</phrase>
        <phrase role="kw">erb</phrase> :index
      <phrase role="kw">end</phrase>
    </programlisting>
      <orderedlist>
        <listitem>
          <para>The browser requests the URL '/' (i.e., index.html)</para>
        </listitem>
        <listitem>
          <para>Get the contents of the file 'index.erb' that is in the ./views directory. </para>
        </listitem>
        <listitem>
          <para>Send that to the browser.</para>
        </listitem>
      </orderedlist>
    </foil>
    <foil>
      <title>Outputting variable data</title>
      <informaltable>
        <tr>
          <td><mediaobject>
              <alt>code</alt>
              <imageobject>
                <imagedata fileref="../images/session_one.jpg"/>
              </imageobject>
            </mediaobject></td>
          <td>&#160;</td>
          <td><itemizedlist>
              <listitem>
                <simpara><filename>index.erb</filename> provides the content that changes on each
                  page (here the index page)</simpara>
              </listitem>
            </itemizedlist></td>
        </tr>
      </informaltable>
    </foil>
    <foil>
      <title>Layouts</title>
      <informaltable>
        <tr>
          <td><mediaobject>
              <alt>code</alt>
              <imageobject>
                <imagedata fileref="../images/session_one.jpg"/>
              </imageobject>
            </mediaobject></td>
          <td>&#160;</td>
          <td><itemizedlist>
              <listitem>
                <simpara><filename>layout.erb</filename> provides the overall structure of the HTML,
                  the stuff that stays the same from page to page</simpara>
              </listitem>
            </itemizedlist></td>
        </tr>
      </informaltable>
    </foil>
    <foil>
      <title>Linkages</title>
      <informaltable>
        <tr>
          <td><mediaobject>
              <alt>code</alt>
              <imageobject>
                <imagedata fileref="../images/annotated_session_one.jpg"/>
              </imageobject>
            </mediaobject></td>
          <td>&#160;</td>
          <td> the arrows show where the parameters are replaced by content </td>
        </tr>
      </informaltable>
      <para/>
    </foil>
    <foil>
      <title>Ruby code dissection</title>
      <programlisting role="other" language="ruby">
      <phrase role="kw">get</phrase> '/' <phrase role="kw">do</phrase>
        <varname>@title</varname> = "Index"
        <phrase role="kw">erb</phrase> :index
      <phrase role="kw">end</phrase>
    </programlisting>
      <orderedlist>
        <listitem>
          <para>The browser requests the URL '/' (i.e., index.html)</para>
        </listitem>
        <listitem>
          <para>Get the contents of the file 'index.erb' that is in the ./views directory. </para>
        </listitem>
        <listitem>
          <para>Set the content of the parameter (@title) to 'Index'.</para>
        </listitem>
        <listitem>
          <para>Combine the content of the layout.erb and index.erb files, after replacing
            appropriate content.</para>
        </listitem>
        <listitem>
          <para>Send that complete file to the browser.</para>
        </listitem>
      </orderedlist>
    </foil>
    <foil>
      <title>Let's try it out</title>
      <para/>
    </foil>
  </foilgroup>
</slides>
