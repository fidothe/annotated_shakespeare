<?dbhtml pygments="true"?>
<slides xml:lang="en" xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink">
  <info>
    <title>Practical Web Applications</title>
    <subtitle>Session Two</subtitle>
    <!-- authors are alphabetical by first name (I get sick of being listed last all the time, 
so I always do this if I can) -->
    <authorgroup>
      <author>
        <personname>
          <firstname>Lauren</firstname>
          <surname>Wood</surname>
        </personname>
        <affiliation>
          <orgname>Textuality Services, Inc.</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Matt</firstname>
          <surname>Patterson</surname>
        </personname>
        <affiliation>
          <orgname>Constituent Parts, Ltd.</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Norman </firstname>
          <surname>Walsh</surname>
        </personname>
        <affiliation>
          <orgname>MarkLogic</orgname>
        </affiliation>
      </author>
      <author>
        <personname>
          <firstname>Paul</firstname>
          <surname>Downey</surname>
        </personname>
        <affiliation>
          <orgname>GDS</orgname>
        </affiliation>
      </author>
    </authorgroup>
    <releaseinfo role="version">Version 1.0</releaseinfo>
    <legalnotice>
      <para>Alpha by first name</para>
    </legalnotice>
    <pubdate>2012-09-20</pubdate>
    <copyright>
      <year>2012</year>
      <holder>Lauren Wood, Matt Patterson, Norm Walsh, Paul Downey</holder>
    </copyright>
  </info>
  <foilgroup>
    <foil>
      <title>Latest code &amp; slides</title>
      <para><link xlink:href="https://github.com/fidothe/annotated_shakespeare">https://github.com/fidothe/annotated_shakespeare</link></para>
      <programlisting language="bash"><![CDATA[
$ git clone git://github.com/fidothe/annotated_shakespeare.git]]>
      </programlisting>
    </foil>
    <foil>
      <title>HTTP versus REST</title>
      <mediaobject>
        <alt>The Radcliff Camera</alt>
        <imageobject>
          <imagedata fileref="../images/posse.jpg" />
        </imageobject>
      </mediaobject>
    </foil>
    <foil>
      <title>HTTP Verbs</title>
      <programlisting>
method     safe    idempotent   semantics    resource     cacheable
          -----------------------------------------------------------
GET       |  X          X            X           X             X    |
HEAD      |  X          X            X           X             X    |
PUT       |             X            X           X                  |
POST      |                                                    *    |
DELETE    |             X            X           X                  |
OPTIONS   |  X          X            X                              |
          -----------------------------------------------------------
PROPFIND  |  X          X            X           X             *    |
PROPPATCH |             X            X           X                  |
MKCOL     |             *            X           X                  |
COPY      |             X            X           X                  |
MOVE      |             ?            X           X                  |
LOCK      |                          X           X                  |
UNLOCK    |             X            X           X                  |
PATCH     |             *            X           X                  |
          -----------------------------------------------------------
      </programlisting>
    </foil>
  </foilgroup>
  <foilgroup>
    <title>Modelling Plays for our app</title>
    <foil>
      <title>What's in a play?</title>
      <para>Let's consider what the most basic parts of the play are:</para>
      <itemizedlist>
        <listitem>
          <para>The title of the play</para>
        </listitem>
        <listitem>
          <para>Who wrote it</para>
        </listitem>
        <listitem>
          <para>How it's broken up into acts and scenes</para>
        </listitem>
        <listitem>
          <para>Characters</para>
        </listitem>
        <listitem>
          <para>The text itself</para>
        </listitem>
      </itemizedlist>
      <para>What does the data we have make easier for us?</para>
      <speakernotes>
        <para>Before we begin just blindly throwing things around, we should stop and consider
          what data we actually have to hand, how it's structured, what we want from it, and
          how easy it is to get things out of it.</para>
        <para>The play XML gives us some things twice, like the title and author. We need to
          pick one, but it's pretty clear what they are.</para>
        <para>The structure of the play is less clear, because the markup is primarily aimed
          at preserving the printed characteristics of the manuscript. If we look closely
          we can see that although there are no explicit 'Act' or 'Scene' elements the &lt;head&gt;
          element is only used to mark the title of the play (its third appearance) and 
          what look like Act or Scene titles.</para>
        <para>Characters are called out, but just as strings: not with ID refs or anything 
          unambiguous. For ease, I think we'll have to ignore those.</para>
        <para>The XML contains element and text content for all the various bits of metadata 
          and elizabethan typesetting notes, but the play's text is unambigously within the
          &lt;text&gt; element, and the metadata's all outside that, so that's alright.</para>
      </speakernotes>
    </foil>
  </foilgroup>
  <foilgroup>
    <title>Designing the URLs</title>
    <foil>
      <title>What resources are there?</title>
      <para>At first glance</para>
      <itemizedlist>
        <listitem>
          <para>Play</para>
        </listitem>
        <listitem>
          <para>Act</para>
        </listitem>
      </itemizedlist>
    </foil>
    <foil>
      <title>How should they be exposed?</title>
      <para>We actually need more than we thought</para>
      <itemizedlist>
        <listitem>
          <para>A list of all Plays</para>
        </listitem>
        <listitem>
          <para>An individual Play</para>
        </listitem>
        <listitem>
          <para>An Act of a Play</para>
        </listitem>
      </itemizedlist>
    </foil>
    <foil>
      <title>The URLs</title>
      <itemizedlist>
        <listitem>
          <para><code>/</code></para>
        </listitem>
        <listitem>
          <para><code>/plays/caesar</code></para>
        </listitem>
        <listitem>
          <para><code>/plays/caesar/act/1</code></para>
        </listitem>
      </itemizedlist>
    </foil>
    <foil>
      <title>Routing in Sinatra</title>
      <programlisting language="ruby"><xi:include href="ex/base_routes.rb" parse="text"/></programlisting>
      <speakernotes>
        <para>Sinatra uses methods named for HTTP methods to declare routes.</para>
        <para>These are all GET routes. The <code>:param_name</code> sections in the URL 
          patterns are placeholders for variable parts of the URL, e.g. <code>/plays/caesar</code>
          or <code>/plays/hamlet</code> will both match <code>get "/plays/:id"</code>, and
          <code>caesar</code> or <code>hamlet</code> will be accessible as a parameter named
          <code>:id</code>.</para>
      </speakernotes>
    </foil>
    <foil>
      <title>Holes in the URI space</title>
      <para>With the holes that leaves in the URL space, we probably also need:</para>
      <itemizedlist>
        <listitem>
          <para><code>/plays</code></para>
        </listitem>
        <listitem>
          <para><code>/plays/:id/act</code></para>
        </listitem>
      </itemizedlist>
      <speakernotes>
        <para>Before we add these extra routes in, it's worth trying out the first set.</para>
        <para>If you were to put the URL <code>/plays/caesar/act/1</code> in to your browser
          and start to hack off chunks of the URL then you'll see 404s at
          <code>/plays/caesar/act</code> and <code>/plays</code>.</para>
        <para>These extra routes avoid that by redirecting the browser to the next level up</para>
      </speakernotes>
    </foil>
    <foil>
      <title>Routing in Sinatra</title>
      <programlisting language="ruby"><xi:include href="ex/routes_plus_redirects.rb" parse="text"/></programlisting>
    </foil>
  </foilgroup>
</slides>
